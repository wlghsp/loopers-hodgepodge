# ë¸”ë¡œê·¸ ìº¡ì³ ì²´í¬ë¦¬ìŠ¤íŠ¸

## ğŸ“‹ í•„ìš”í•œ ìº¡ì³ (ì´ 12ê°œ)

### ì½”ë“œ ìº¡ì³ (5ê°œ)
1. [ ] Circuit Breaker ì„¤ì •
2. [ ] Fallback ì²˜ë¦¬
3. [ ] ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„
4. [ ] ì½œë°± ì²˜ë¦¬
5. [ ] ë©±ë“±ì„± ì²˜ë¦¬

### ì‹¤í–‰ ìº¡ì³ (7ê°œ)
6. [ ] ì •ìƒ ê²°ì œ API ì‘ë‹µ
7. [ ] ì •ìƒ ê²°ì œ ë¡œê·¸
8. [ ] PG ì¥ì•  ì‹œ Fallback API ì‘ë‹µ
9. [ ] PG ì¥ì•  ì‹œ Fallback ë¡œê·¸
10. [ ] ìŠ¤ì¼€ì¤„ëŸ¬ ë³µêµ¬ ë¡œê·¸
11. [ ] Circuit Breaker OPEN ìƒíƒœ
12. [ ] DB ìƒíƒœ (PENDING ì£¼ë¬¸)

---

## ğŸ“¸ ìƒì„¸ ìº¡ì³ í•­ëª©

### ì½”ë“œ ìº¡ì³ (IntelliJ)

### 1. Circuit Breaker ì„¤ì • âœ…
- [x] `apps/commerce-api/src/main/resources/application.yml` (42-64ì¤„)
  - resilience4j.circuitbreaker ë¶€ë¶„
  - slow-call-duration-threshold: 2s (ëŠë¦° í˜¸ì¶œ ê¸°ì¤€)
  - **ì´ë¯¸ì§€**: 03-circuit-breaker-config.png

### 2. Fallback ì²˜ë¦¬ âœ…
- [x] `apps/commerce-api/src/main/kotlin/com/loopers/domain/payment/PaymentService.kt` (65-89ì¤„)
  - paymentFallback ë©”ì„œë“œ
  - **ì´ë¯¸ì§€**: 02-fallback-handling.png

### 3. ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„ âœ…
- [x] `apps/commerce-api/src/main/kotlin/com/loopers/infrastructure/payment/PaymentRecoveryScheduler.kt` (25-42ì¤„)
  - recoverPendingPayments ë©”ì„œë“œ
  - **ì´ë¯¸ì§€**: 04-scheduler.png

### 4. ì½œë°± ì²˜ë¦¬ âœ…
- [x] `apps/commerce-api/src/main/kotlin/com/loopers/domain/payment/PaymentCallbackService.kt` (16-35ì¤„)
  - handlePaymentCallback ë©”ì„œë“œ
  - **ì´ë¯¸ì§€**: 05-callback-handling.png

### 5. ë©±ë“±ì„± ì²˜ë¦¬ âœ…
- [x] `apps/commerce-api/src/main/kotlin/com/loopers/domain/payment/PaymentCallbackService.kt` (21-23ì¤„)
  - if (payment.status != PaymentStatus.PENDING) return ë¶€ë¶„
  - **ì´ë¯¸ì§€**: 06-idempotency.png

## API í…ŒìŠ¤íŠ¸ ìº¡ì³

### 6. ì •ìƒ ê²°ì œ API
- [ ] `http/commerce-api/order-card-payment.http` ì‹¤í–‰
  - ì¹´ë“œ ê²°ì œ ìš”ì²­ ì„±ê³µ ì‘ë‹µ

### 7. ì •ìƒ ê²°ì œ ë¡œê·¸
- [ ] commerce-api ì½˜ì†”
  - `PG response received: transactionKey=xxx, status=PENDING`
  - `Payment callback received: transactionKey=xxx, status=SUCCESS`
  - `Payment callback processed successfully: orderId=1, paymentId=1`

### 8. PG ì¥ì•  ì‹œ Fallback API
- [ ] pg-simulator ì¤‘ë‹¨ í›„ ìš”ì²­
  - Fallback ì‘ë‹µ (PENDING ìƒíƒœ)

### 9. PG ì¥ì•  ì‹œ Fallback ë¡œê·¸
- [ ] commerce-api ì½˜ì†”
  - `Payment fallback triggered for order: 1, amount: 10000`
  - `í˜„ì¬ ì¹´ë“œ ê²°ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`

### 10. ìŠ¤ì¼€ì¤„ëŸ¬ ë³µêµ¬ ë¡œê·¸
- [ ] commerce-api ì½˜ì†”
  - `Found N stale orders to reconcile`
  - `Recovered payment: orderId=1, transactionKey=xxx`

### 11. Circuit Breaker OPEN (ì—°ê²°ëœ ì‹œë‚˜ë¦¬ì˜¤)
- [ ] commerce-api ì½˜ì†”
  - `Circuit Breaker State Changed! From: CLOSED To: OPEN`
  - **ë°©ë²•**: PG ì¤‘ë‹¨ â†’ 20ë²ˆ ì´ìƒ ìš”ì²­

### 12. DB ìƒíƒœ í™•ì¸ (11ë²ˆê³¼ ê°™ì€ ì‹œë‚˜ë¦¬ì˜¤)
- [ ] MySQL ì¿¼ë¦¬ ê²°ê³¼
  - Circuit OPENìœ¼ë¡œ ìƒì„±ëœ PENDING ì£¼ë¬¸ë“¤ (20ê°œ+)
  - `SELECT * FROM orders WHERE status = 'PENDING' ORDER BY id DESC;`

## í…ŒìŠ¤íŠ¸ ë°©ë²•

`.codeguide/round6/blog/í…ŒìŠ¤íŠ¸_ê°€ì´ë“œ.md` ì°¸ê³ 

